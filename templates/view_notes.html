<!-- view_notes.html -->

{% extends "base.html" %}

{% block content %}
  <h2>Your Notes</h2>
  <ul>
    {% for note in notes %}
      <li>
        {{ note.content }}
        {% if note.encrypted %}
          <form id="decrypt-form-{{ note.id }}" class="decrypt-form" action="/decrypt_note/{{ note.id }}" method="post">
            <input type="password" name="password" placeholder="Enter password">
            <button type="button" onclick="decryptNote({{ note.id }})">Decrypt</button>
          </form>
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  <script>
    function decryptNote(noteId) {
      var password = prompt("Enter password:");
      if (password) {
        var form = document.getElementById("decrypt-form-" + noteId);
        form.querySelector("input[name='password']").value = password;

        fetch(form.action, {
          method: 'POST',
          body: new FormData(form),
          credentials: 'include'
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert("Decrypted content:\n" + data.decrypted_content);
          } else {
            alert("Failed to decrypt note. " + data.message);
          }
        });
      }
    }
  </script>
{% endblock %}
